<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>ê²½ì¡°ì‚¬ ë©”ì‹œì§€ ìƒì„±ê¸°</title>
  <meta name="description" content="ê²°í˜¼, ì¥ë¡€, ëŒì”ì¹˜, ë¶€ëª¨ë‹˜ì”ì¹˜, ë°˜ë ¤ë™ë¬¼ ì¥ë¡€ ë©”ì‹œì§€ ìƒì„±/ê³µìœ " />
  <style>
    :root{
      --bg:#0b0c10; --card:#121319; --muted:#7d8590; --text:#e6edf3; --acc:#6dd3fb; --acc2:#b7f399;
      --danger:#ff6b6b; --ok:#34d399; --brand:#6366f1; --shadow:0 10px 30px rgba(0,0,0,.25);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:linear-gradient(180deg,#0b0c10, #0e1117 40%, #0b0c10);
         color:var(--text);font-family: ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans KR",Apple SD Gothic Neo,Helvetica,Arial,sans-serif;
         -webkit-font-smoothing:antialiased;}
    .wrap{max-width:680px;margin:0 auto;padding:24px;}
    .card{background:var(--card);border:1px solid #1f232b;border-radius:20px;padding:20px;box-shadow:var(--shadow)}
    h1{font-size:24px;margin:0 0 10px;letter-spacing:-.3px}
    p.lead{margin:0 0 16px;color:var(--muted);font-size:14px}
    .grid{display:grid;gap:14px}
    .row{display:flex;gap:8px;flex-wrap:wrap}
    label{display:block;font-weight:600;margin-bottom:8px}
    .radio-group{display:grid;gap:10px}
    .radio{display:flex;align-items:center;gap:10px;background:#0e1320;border:1px solid #202635;padding:12px;border-radius:14px}
    .radio input{transform:scale(1.2)}
    .note{font-size:12px;color:var(--muted)}
    input[type="text"], .ghost{
      width:100%;padding:12px 14px;border-radius:12px;border:1px solid #263042;background:#0b1222;color:var(--text);outline:none;
    }
    input[type="text"]:focus{border-color:var(--acc)}
    button{appearance:none;border:0;border-radius:14px;padding:14px 16px;font-weight:700;cursor:pointer}
    .btn{background:linear-gradient(135deg,var(--brand),#22d3ee);color:#fff;box-shadow:0 8px 20px rgba(99,102,241,.3)}
    .btn:active{transform:translateY(1px)}
    .btn-ghost{background:transparent;color:var(--text);border:1px solid #253046}
    .hidden{display:none}

    /* Viewer */
    .viewer h2{font-size:20px;margin:0 0 12px}
    .meta{display:flex;gap:8px;flex-wrap:wrap;color:var(--muted);font-size:12px;margin-bottom:10px}
    .paper{background:#0c111b;border:1px dashed #24314a;border-radius:16px;padding:18px}
    $1
    .heroimg{width:100%;max-height:320px;object-fit:cover;border-radius:12px;border:1px solid #24314a;display:block;margin:0 auto 10px;}
    .toolbar{display:flex;gap:8px;flex-wrap:wrap;margin-top:14px}

    /* Tiny icon badges */
    .badge{display:inline-flex;align-items:center;gap:8px;padding:10px;border-radius:14px;border:1px solid #24314a;background:#0b1222}
    .ico{display:inline-grid;place-items:center;width:28px;height:28px;border-radius:9px;background:#111a2c}
    .ico svg{width:18px;height:18px}

    @media (prefers-color-scheme: light){
      :root{--bg:#f6f8fa;--card:#ffffff;--text:#0d1117;--muted:#57606a}
      body{background:linear-gradient(180deg,#f6f8fa,#fff)}
      .radio{background:#f8fafc;border-color:#e5e7eb}
      input[type="text"], .ghost{background:#fff;border-color:#e5e7eb}
      .paper{background:#fafcff;border-color:#e5e7eb}
      .btn-ghost{border-color:#e5e7eb}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <!-- Screen 1: Form -->
    <section id="screen-form" class="card">
      <div class="row" style="justify-content:space-between;align-items:center">
        <h1>ê²½ì¡°ì‚¬ ë©”ì‹œì§€ ìƒì„±ê¸°</h1>
        <div class="badge"><span class="ico" aria-hidden="true">ğŸ’Œ</span>ê°„í¸ ìƒì„± Â· ê³µìœ  ë§í¬</div>
      </div>
      <p class="lead">í•„ìš”í•œ ê²½ì¡°ì‚¬ ë¬¸êµ¬ë¥¼ ì„ íƒí•˜ê³  ì •ë³´ë¥¼ ì…ë ¥í•˜ì„¸ìš”. ìƒì„± í›„ ë§í¬ë¡œ ê³µìœ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

      <div class="grid">
        <div>
          <label>ì§ˆë¬¸1. ê²½ì¡°ì‚¬ ì¢…ë¥˜ë¥¼ ì„ íƒí•˜ì„¸ìš” <span class="note">(í•„ìˆ˜)</span></label>
          <div class="radio-group" role="radiogroup" aria-label="ê²½ì¡°ì‚¬ ì¢…ë¥˜">
            <label class="radio"><input type="radio" name="type" value="wedding"> ê²°í˜¼</label>
            <label class="radio"><input type="radio" name="type" value="funeral"> ê°€ì¡±ì¥ë¡€ì‹</label>
            <label class="radio"><input type="radio" name="type" value="firstbirthday"> ëŒì”ì¹˜</label>
            <label class="radio"><input type="radio" name="type" value="parents"> ë¶€ëª¨ë‹˜ì”ì¹˜</label>
            <label class="radio"><input type="radio" name="type" value="petfuneral"> ì• ê²¬Â·ì• ë¬˜ ì¥ë¡€ì‹</label>
          </div>
        </div>

        <div id="row-aaa" class="hidden">
          <label>ì§ˆë¬¸2. ëŒì”ì¹˜ì¸ ê²½ìš°, ì•„ì´ ì´ë¦„ <span class="note">(ì„ íƒ)</span></label>
          <input type="text" id="input-aaa" maxlength="20" placeholder="ì•„ì´ ì´ë¦„ (ì˜ˆ: ì§€ìš°)" />
          <p class="note">ì…ë ¥ ì‹œ ë©”ì‹œì§€ ë‚´ AAAê°€ ì•„ì´ ì´ë¦„ìœ¼ë¡œ ë°”ë€ë‹ˆë‹¤.</p>
        </div>

        <div>
          <label>ì§ˆë¬¸3. ë°œì†¡í•˜ëŠ” ë¶„ì˜ ì´ë¦„ <span class="note">(í•„ìˆ˜)</span></label>
          <input type="text" id="input-bbb" maxlength="20" placeholder="ë³´ë‚´ëŠ” ì´ (ì˜ˆ: ê¹€OO)" required />
        </div>

        <div class="row" style="justify-content:flex-end;margin-top:4px">
          <button id="btn-generate" class="btn">ìƒì„±ëœ ê²½ì¡°ì‚¬ ë¬¸êµ¬ HTML ë³´ê¸°</button>
        </div>
      </div>
    </section>

    <!-- Screen 2: Viewer -->
    <section id="screen-view" class="card hidden viewer">
      <div class="row" style="justify-content:space-between;align-items:center">
        <h2 id="view-title">ë©”ì‹œì§€ ë³´ê¸°</h2>
        <div id="badge-type" class="badge"><span class="ico" id="type-emoji" aria-hidden="true">âœ¨</span><span id="type-label">ìœ í˜•</span></div>
      </div>
      <div class="meta" id="meta"></div>

      <div class="paper">
        <div id="msg-image" style="text-align:center;margin-bottom:10px;font-size:28px"></div>
        <div id="message" class="msg"></div>
      </div>

      <div class="toolbar">
        <button id="btn-copy" class="btn">ë§í¬ ë³µì‚¬</button>
        <button id="btn-share" class="btn-ghost">ê³µìœ í•˜ê¸°</button>
        <button id="btn-home" class="btn-ghost">ì²˜ìŒìœ¼ë¡œ</button>
      </div>
    </section>
  </div>

  <script>
    // --- Utilities ---
    const $ = (s)=>document.querySelector(s);
    const byId = (id)=>document.getElementById(id);

    const typeMeta = {
      wedding: {label:'ê²°í˜¼', emoji:'ğŸ’', image:'img01.png'},
      funeral: {label:'ê°€ì¡±ì¥ë¡€ì‹', emoji:'ğŸ•Šï¸', image:'img02.png'},
      firstbirthday: {label:'ëŒì”ì¹˜', emoji:'ğŸ‚', image:'img03.png'},
      parents: {label:'ë¶€ëª¨ë‹˜ì”ì¹˜', emoji:'ğŸŒ·', image:'img04.png'},
      petfuneral: {label:'ì• ê²¬Â·ì• ë¬˜ ì¥ë¡€ì‹', emoji:'ğŸ¾', image:'img05.png'}
    };

    function todayString(){
      const now = new Date();
      const y = now.getFullYear();
      const m = String(now.getMonth()+1).padStart(2,'0');
      const d = String(now.getDate()).padStart(2,'0');
      return `${y}ë…„ ${m}ì›” ${d}ì¼`;
    }

    function randId(len=12){
      // base36 random id, >= 9 chars
      let s = '';
      while(s.length < len){ s += Math.random().toString(36).slice(2); }
      return s.slice(0,len);
    }

    function encodePayload(obj){
      const json = JSON.stringify(obj);
      const b64 = btoa(unescape(encodeURIComponent(json))); // base64
      return b64.replaceAll('+','-').replaceAll('/','_').replace(/=+$/,''); // url-safe
    }
    function decodePayload(str){
      const b64 = str.replaceAll('-','+').replaceAll('_','/');
      const pad = '='.repeat((4 - (b64.length % 4)) % 4);
      const json = decodeURIComponent(escape(atob(b64 + pad)));
      return JSON.parse(json);
    }

    function sanitize(text){
      return String(text||'').replace(/[&<>\"']/g, s=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[s]));
    }

    // --- Templates ---
    const templates = {
      wedding: `ì˜¤ë˜ì „ë¶€í„° ë‘ ë¶„ì˜ ì†Œì¤‘í•œ ì¸ì—°ì„ ì§€ì¼œë³´ë©° ì˜¤ëŠ˜ì„ ì†ê¼½ì•„ ê¸°ë‹¤ë ¸ìŠµë‹ˆë‹¤. ì§„ì‹¬ìœ¼ë¡œ ì¶•í•˜ë“œë¦½ë‹ˆë‹¤.
ë‘ ì‚¬ëŒì´ í•¨ê»˜í•˜ëŠ” ìƒˆë¡œìš´ ì‹œì‘ì— ì•„ë‚Œì—†ëŠ” ì¶•ë³µì„ ë³´ëƒ…ë‹ˆë‹¤. ì´ì œ ì„œë¡œì˜ ë¶€ì¡±í•¨ì„ ì±„ì›Œì£¼ê³ , ê¸°ì  ë•Œë‚˜ ìŠ¬í”Œ ë•Œë‚˜ ë³€í•¨ì—†ì´ ê³ì„ ì§€í‚¤ë©°, ì„œë¡œì—ê²Œ ê°€ì¥ ë“ ë“ í•œ ë²„íŒ€ëª©ì´ ë˜ì–´ì£¼ì„¸ìš”. ì„œë¡œë¥¼ ì¡´ì¤‘í•˜ê³  ì•„ë¼ëŠ” ë§ˆìŒìœ¼ë¡œ ë§Œë“¤ì–´ê°€ëŠ” ê°€ì •ì€ ë¶„ëª… ì´ ì„¸ìƒ ê·¸ ì–´ë–¤ ë³´ì„ë³´ë‹¤ ë¹›ë‚  ê²ƒì…ë‹ˆë‹¤. ë‘ ë¶„ì˜ ì‚¬ë‘ì´ ëŠ˜ ì˜¤ëŠ˜ì²˜ëŸ¼ ì•„ë¦„ë‹µê²Œ ë¹›ë‚˜ê¸°ë¥¼ ë°”ë¼ë©°, í•¨ê»˜í•˜ëŠ” ë§¤ì¼ë§¤ì¼ì´ í–‰ë³µê³¼ ì‚¬ë‘ìœ¼ë¡œ ê°€ë“í•˜ê¸¸ ì§„ì‹¬ìœ¼ë¡œ ê¸°ë„í•˜ê² ìŠµë‹ˆë‹¤.

ì§ì ‘ ì°¾ì•„ê°€ ë‘ ë¶„ì˜ í–‰ë³µí•œ ìˆœê°„ì„ í•¨ê»˜í•˜ê³  ì‹¶ì—ˆìœ¼ë‚˜, ë¶€ë“ì´í•˜ê²Œ ì°¸ì„í•˜ì§€ ëª»í•´ ì•„ì‰¬ìš´ ë§ˆìŒ ê¸ˆí•  ê¸¸ì´ ì—†ìŠµë‹ˆë‹¤. ë„ˆë¥¸ ë§ˆìŒìœ¼ë¡œ ì–‘í•´í•´ì£¼ì‹œë©´ ê°ì‚¬í•˜ê² ìŠµë‹ˆë‹¤. ì´ë ‡ê²Œ ë§ˆìŒìœ¼ë¡œë‚˜ë§ˆ ë‘ ë¶„ì˜ ì•ë‚ ì„ ì‘ì›í•˜ë©° ì¶•ë³µì˜ ë§ˆìŒì„ ì „í•©ë‹ˆë‹¤.
ë‹¤ì‹œ í•œë²ˆ ê²°í˜¼ì„ ì§„ì‹¬ìœ¼ë¡œ ì¶•í•˜í•˜ë©°, ë‘ ë¶„ì˜ ì•ë‚ ì— ê±´ê°•ê³¼ í–‰ë³µì´ ê°€ë“í•˜ê¸°ë¥¼ ë°”ëë‹ˆë‹¤.
{ë°œì†¡í•œ ë‚ ì§œ}

BBB ë“œë¦¼`,
      funeral: `ê°€ìŠ´ ì•„í”ˆ ì†Œì‹ì— ìŠ¬í””ì„ ê¸ˆí•  ê¸¸ì´ ì—†ìŠµë‹ˆë‹¤. ì‚¬ë‘í•˜ëŠ” ë¶„ì„ ëœ»í•˜ì§€ ì•Šê²Œ ë– ë‚˜ë³´ë‚¸ ìƒì£¼ë‹˜ê»˜ ê¹Šì€ ìœ„ë¡œì˜ ë§ì”€ì„ ì „í•©ë‹ˆë‹¤. ì‚¼ê°€ ê³ ì¸ì˜ ëª…ë³µì„ ë¹•ë‹ˆë‹¤.
ê°‘ì‘ìŠ¤ëŸ¬ìš´ ì´ë³„ì˜ ì•„í””ì€ ì–´ë–¤ ë§ë¡œë„ ìœ„ë¡œê°€ ë˜ì§€ ì•Šìœ¼ë¦¬ë¼ ìƒê°í•©ë‹ˆë‹¤. í•¨ê»˜í–ˆë˜ ì•„ë¦„ë‹¤ìš´ ì‹œê°„ê³¼ ì†Œì¤‘í•œ ì¶”ì–µë“¤ì´ ì´ì œëŠ” ê·¸ë¦¬ì›€ì´ë¼ëŠ” ì´ë¦„ìœ¼ë¡œ ë‚¨ì•˜ì„ ê²ƒì…ë‹ˆë‹¤. ë¶€ë”” ë§ˆìŒì†ì— ë‹´ì•„ë‘ì—ˆë˜ ëª¨ë“  ìŠ¬í””ê³¼ ê·¸ë¦¬ì›€ì„ ì¶©ë¶„íˆ í˜ë ¤ë³´ë‚´ì‹œê³ , ë‹¤ì‹œê¸ˆ í‰ì˜¨ì„ ì°¾ìœ¼ì‹œê¸°ë¥¼ ì§„ì‹¬ìœ¼ë¡œ ê¸°ë„í•©ë‹ˆë‹¤. ì´ ë¹„í†µí•œ ì‹œê°„ë“¤ì„ ì´ê²¨ë‚¼ ìˆ˜ ìˆë„ë¡ ìƒì£¼ë‹˜ê³¼ ê°€ì¡±ë¶„ë“¤ì˜ ë§ˆìŒì— ë”°ëœ»í•œ ìœ„ì•ˆì´ ê¹ƒë“¤ê¸°ë¥¼ ë°”ëë‹ˆë‹¤.

ì§€ê¸ˆ ë‹¹ì¥ì´ë¼ë„ ë‹¬ë ¤ê°€ ìŠ¬í””ì„ í•¨ê»˜ ë‚˜ëˆ„ê³  ì‹¶ì€ ë§ˆìŒ êµ´ëšê°™ì§€ë§Œ, ì• ì„í•˜ê²Œë„ ê°œì¸ì ì¸ ì‚¬ì •ìœ¼ë¡œ ì¸í•´ ì§ì ‘ ì°¾ì•„ëµ™ì§€ ëª»í•˜ëŠ” ì , ë„“ì€ ë§ˆìŒìœ¼ë¡œ í—¤ì•„ë ¤ì£¼ì‹œë©´ ê°ì‚¬í•˜ê² ìŠµë‹ˆë‹¤. ì´ë ‡ê²Œ ë§ˆìŒìœ¼ë¡œë§Œ í•¨ê»˜í•˜ëŠ” ê²ƒì´ ì†¡êµ¬ìŠ¤ëŸ½ì§€ë§Œ, ë¨¼ë°œì¹˜ì—ì„œë‚˜ë§ˆ ê¹Šì€ ì• ë„ë¥¼ í‘œí•˜ë©° ê³ ì¸ê³¼ì˜ ë§ˆì§€ë§‰ ì¸ì‚¬ë¥¼ ëŒ€ì‹ í•˜ê³ ì í•©ë‹ˆë‹¤. ë¶€ë”” ìš©ì„œí•´ ì£¼ì‹­ì‹œì˜¤.
ë‹¤ì‹œ í•œë²ˆ ê³ ì¸ì˜ ì˜ë©´ì„ ê¸°ì›í•˜ë©°, ìŠ¬í””ì— ì ê¸´ ìƒì£¼ë‹˜ê³¼ ê°€ì¡±ë¶„ë“¤ì˜ í‰ì•ˆì„ ë°”ëë‹ˆë‹¤.
{ë°œì†¡í•œ ë‚ ì§œ}

BBB ë“œë¦¼`,
      firstbirthday: `ì‚¬ë‘ìŠ¤ëŸ¬ìš´ AAAì˜ ì²« ë²ˆì§¸ ìƒì¼ì„ ì§„ì‹¬ìœ¼ë¡œ ì¶•í•˜í•©ë‹ˆë‹¤. ì†Œì¤‘í•œ ì²«ëŒì„ ì¶•ë³µí•˜ë©°, ì”ì¹˜ë¥¼ ì¤€ë¹„í•œ ë¶€ëª¨ë‹˜ê»˜ë„ ì¶•í•˜ì˜ ë§ì”€ì„ ì „í•©ë‹ˆë‹¤.
ì§€ë‚œ 1ë…„ê°„ í•¨ê»˜ ì›ƒê³  ìš¸ë©° ë°¤ë‚®ì—†ì´ ì• ì“°ì…¨ì„ ë¶€ëª¨ë‹˜ì˜ ë…¸ê³ ì— ì§„ì‹¬ìœ¼ë¡œ ê²½ì˜ë¥¼ í‘œí•©ë‹ˆë‹¤. ìë…€ê°€ ê±´ê°•í•˜ê³  ì”©ì”©í•˜ê²Œ ìë¼ëŠ” ëª¨ìŠµì€ ë¶€ëª¨ë‹˜ê»˜ëŠ” ë”í•  ë‚˜ìœ„ ì—†ëŠ” ê¸°ì¨ì´ì—ˆì„ ê²ƒì…ë‹ˆë‹¤. ì•ìœ¼ë¡œë„ ë¬´ëŸ­ë¬´ëŸ­ ìë¼ ì§€í˜œë¡­ê³  ë°ì€ ì•„ì´ë¡œ ì„±ì¥í•˜ê¸°ë¥¼ ë°”ë¼ë©°, ìë…€ì˜ ì•ë‚ ì— ëŠ˜ í–‰ë³µí•œ ì›ƒìŒê³¼ ì‚¬ë‘ì´ ê°€ë“í•˜ê¸°ë¥¼ ê¸°ë„í•˜ê² ìŠµë‹ˆë‹¤.

ì§ì ‘ ì°¾ì•„ê°€ ì²« ë²ˆì§¸ ìƒì¼ì„ ì¶•í•˜í•´ ì£¼ê³  ì‹¶ì—ˆìœ¼ë‚˜, ë¶€ë“ì´í•œ ì‚¬ì •ìœ¼ë¡œ í•¨ê»˜í•˜ì§€ ëª»í•´ ì•„ì‰¬ìš´ ë§ˆìŒ ê¸ˆí•  ê¸¸ì´ ì—†ìŠµë‹ˆë‹¤. ì´ë ‡ê²Œ ë§ˆìŒìœ¼ë¡œë‚˜ë§ˆ ì²«ëŒì„ ì¶•ë³µí•˜ë©° ì˜¨ ê°€ì¡±ì˜ ì•ë‚ ì— ëŠ˜ í–‰ë³µê³¼ ê¸°ì¨ì´ í•¨ê»˜í•˜ê¸°ë¥¼ ê¸°ì›í•©ë‹ˆë‹¤.
ë‹¤ì‹œ í•œë²ˆ AAAì˜ ì²«ëŒì„ ì¶•í•˜í•˜ë©°, ê°€ì •ì— ëŠ˜ ê±´ê°•ê³¼ í–‰ë³µì´ ê°€ë“í•˜ê¸°ë¥¼ ë°”ëë‹ˆë‹¤.
{ë°œì†¡í•œ ë‚ ì§œ}

BBB ë“œë¦¼`,
      parents: `ì‚¬ë‘í•˜ëŠ” ë¶€ëª¨ë‹˜ê»˜ì„œ ë§ìœ¼ì‹  ì”ì¹˜ë¥¼ ì§„ì‹¬ìœ¼ë¡œ ì¶•í•˜ë“œë¦½ë‹ˆë‹¤. ê·€í•œ ë‚ , ì”ì¹˜ë¥¼ ì¤€ë¹„í•œ ê°€ì¡±ë¶„ë“¤ê»˜ë„ ì¶•í•˜ì˜ ë§ì”€ì„ ì „í•©ë‹ˆë‹¤.
ê°€ì¡±ì„ ìœ„í•´ í‰ìƒì„ í—Œì‹ í•´ ì˜¤ì‹  ë¶€ëª¨ë‹˜ê»˜ì„œ ë§ì´í•˜ì‹¤ ì‚¬ë‘ê³¼ ì¡´ê²½ ì†ì—ì„œ ë³´ë‚´ëŠ” ê°€ì¥ ì•„ë¦„ë‹¤ìš´ ìˆœê°„ì´ ë˜ì‹œê¸¸ ë°”ëë‹ˆë‹¤. ë¶€ëª¨ë‹˜ê»˜ì„œ ë² í‘¸ì‹  ë”°ìŠ¤í•œ ì‚¬ë‘ê³¼ ê¹Šì€ ê°€ë¥´ì¹¨ì´ ìˆì—ˆê¸°ì—, ì§€ê¸ˆì˜ í–‰ë³µí•œ ê°€ì¡±ì´ ì¡´ì¬í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. ê·¸ í¬ì‹  ì‚¬ë‘ì— ê¹Šì´ ê°ì‚¬ë“œë¦¬ë©°, ì•ìœ¼ë¡œë„ ë³€í•¨ì—†ì´ ê±´ê°•í•˜ê³  í–‰ë³µí•˜ê²Œ ì˜¤ë˜ì˜¤ë˜ í•˜ì‹œê¸°ë¥¼ ê°„ì ˆíˆ ë°”ëë‹ˆë‹¤. ê°€ì¡± ëª¨ë‘ì˜ ì¸ìƒì— ë¹›ë‚˜ëŠ” ìˆœê°„ë“¤ì´ ì•ìœ¼ë¡œë„ ì˜ì›íˆ ì´ì–´ì§€ê¸°ë¥¼ ì§„ì‹¬ìœ¼ë¡œ ê¸°ì›í•©ë‹ˆë‹¤.

ì§ì ‘ ì°¾ì•„ëµ™ê³  ì¶•í•˜ì˜ ì¸ì‚¬ë¥¼ ì „í•´ì•¼ ë§ˆë•…í•˜ì§€ë§Œ, ë¶€ë“ì´í•œ ì‚¬ì •ìœ¼ë¡œ í•¨ê»˜í•˜ì§€ ëª»í•´ ì£„ì†¡í•œ ë§ˆìŒ ê¸ˆí•  ê¸¸ì´ ì—†ìŠµë‹ˆë‹¤. ì´ë ‡ê²Œë‚˜ë§ˆ ë§ˆìŒìœ¼ë¡œ ê¹Šì€ ì¡´ê²½ê³¼ ì¶•í•˜ë¥¼ ì „í•˜ëŠ” ì , ë„ˆê·¸ëŸ¬ì´ ì´í•´í•´ì£¼ì‹œë©´ ê°ì‚¬í•˜ê² ìŠµë‹ˆë‹¤.
ë‹¤ì‹œ í•œë²ˆ ë¶€ëª¨ë‹˜ì˜ ëœ»ê¹Šì€ ì”ì¹˜ë¥¼ ì¶•í•˜ë“œë¦¬ë©°, ê°€ì •ì— ëŠ˜ ê±´ê°•ê³¼ í–‰ë³µì´ ê°€ë“í•˜ê¸°ë¥¼ ë°”ëë‹ˆë‹¤.
{ë°œì†¡í•œ ë‚ ì§œ}

BBB ë“œë¦¼`,
      petfuneral: `ì‚¬ë‘í•˜ëŠ” ê°€ì¡±ì„ ë– ë‚˜ë³´ë‚¸ ì¹œêµ¬ì—ê²Œ ê¹Šì€ ìœ„ë¡œì˜ ë§ˆìŒì„ ì „í•©ë‹ˆë‹¤. ê°‘ì‘ìŠ¤ëŸ¬ìš´ ì´ë³„ ì†Œì‹ì— ì € ë˜í•œ ë§ˆìŒì´ ë§ì´ ì•„í”•ë‹ˆë‹¤.
ê°€ì¡±ì´ë‚˜ ë‹¤ë¦„ì—†ì—ˆë˜ ì†Œì¤‘í•œ ì¡´ì¬ë¥¼ ë– ë‚˜ë³´ë‚¸ ìŠ¬í””ì€ ì–´ë–¤ ë§ë¡œë„ í—¤ì•„ë¦´ ìˆ˜ ì—†ìœ¼ë¦¬ë¼ ìƒê°í•©ë‹ˆë‹¤. í•¨ê»˜í–ˆë˜ ëª¨ë“  ì‹œê°„ë“¤ì´ ì†Œì¤‘í•œ ì¶”ì–µìœ¼ë¡œ ë‚¨ì•˜ì„ ê²ƒì…ë‹ˆë‹¤. ë¶€ë”” ë§ˆìŒì† ê¹Šì´ ê°„ì§í•˜ê³  ìˆë˜ ëª¨ë“  ìŠ¬í””ê³¼ ê·¸ë¦¬ì›€ì„ ì¶©ë¶„íˆ í˜ë ¤ë³´ë‚´ê³ , ë‹¤ì‹œ ì¼ìƒìœ¼ë¡œ ëŒì•„ì™€ í‰ì˜¨ì„ ì°¾ê¸°ë¥¼ ì§„ì‹¬ìœ¼ë¡œ ë°”ëë‹ˆë‹¤. ì´ í˜ë“  ì‹œê°„ì„ ì˜ ì´ê²¨ë‚¼ ìˆ˜ ìˆë„ë¡ ì¹œêµ¬ì™€ ê°€ì¡±ì˜ ë§ˆìŒì— ë”°ëœ»í•œ ìœ„ì•ˆì´ ê¹ƒë“¤ê¸°ë¥¼ ê¸°ë„í•˜ê² ìŠµë‹ˆë‹¤.

ì§ì ‘ ì°¾ì•„ê°€ ìŠ¬í””ì„ í•¨ê»˜ ë‚˜ëˆ„ê³  ì‹¶ì—ˆìœ¼ë‚˜, ì—¬ì˜ì¹˜ ì•Šì•„ ë§ˆìŒìœ¼ë¡œë§Œ í•¨ê»˜í•˜ëŠ” ì  ì´í•´í•´ì£¼ê¸¸ ë°”ëë‹ˆë‹¤. ì´ë ‡ê²Œ ë©”ì‹œì§€ë¡œ ëŒ€ì‹ í•˜ëŠ” ì ì´ ì†¡êµ¬ìŠ¤ëŸ½ì§€ë§Œ, ë¨¼ë°œì¹˜ì—ì„œë‚˜ë§ˆ ê¹Šì€ ì• ë„ë¥¼ í‘œí•©ë‹ˆë‹¤.
ë‹¤ì‹œ í•œë²ˆ ê¹Šì€ ìœ„ë¡œì˜ ë§ì”€ì„ ì „í•˜ë©°, ë§ˆìŒì— í‰ì•ˆì´ ê¹ƒë“¤ê¸°ë¥¼ ë°”ëë‹ˆë‹¤.
{ë°œì†¡í•œ ë‚ ì§œ}

BBB ë“œë¦¼`
    };

    // --- State & Elements ---
    const rowAAA = byId('row-aaa');
    const inputAAA = byId('input-aaa');
    const inputBBB = byId('input-bbb');

    document.querySelectorAll('input[name="type"]').forEach(r=>{
      r.addEventListener('change',()=>{
        rowAAA.classList.toggle('hidden', r.value !== 'firstbirthday' || !r.checked);
      });
    });

    byId('btn-generate').addEventListener('click', (e)=>{
      e.preventDefault();
      const type = (document.querySelector('input[name="type"]:checked')||{}).value;
      if(!type){ alert('ê²½ì¡°ì‚¬ ì¢…ë¥˜ë¥¼ ì„ íƒí•˜ì„¸ìš”.'); return; }
      const bbbRaw = inputBBB.value.trim();
      if(!bbbRaw){ alert('ë°œì†¡ì ì´ë¦„(BBB)ì„ ì…ë ¥í•˜ì„¸ìš”.'); return; }
      const aaaRaw = type==='firstbirthday' ? inputAAA.value.trim() : '';

      const date = todayString();
      const payload = { t:type, a: aaaRaw, b: bbbRaw, d: date };
      const id = randId(12);
      const p = encodePayload(payload);
      const url = `${location.origin}${location.pathname}#v=1&r=${id}&p=${p}`;
      // Navigate to viewer
      location.href = url;
    });

    // --- Viewer logic ---
    function show(name){
      byId('screen-form').classList.toggle('hidden', name!=='form');
      byId('screen-view').classList.toggle('hidden', name!=='view');
    }

    function applyTemplate({t,a,b,d}){
      const meta = typeMeta[t] || {label:'ë©”ì‹œì§€',emoji:'âœ¨',image:'âœ¨'};
      byId('view-title').textContent = `${meta.label} ë©”ì‹œì§€`;
      byId('type-label').textContent = meta.label;
      byId('type-emoji').textContent = meta.emoji;
      const imgWrap = byId('msg-image');
      imgWrap.innerHTML = '';
      if (meta.image) {
        const img = document.createElement('img');
        img.src = /^(https?:)?\//.test(meta.image) ? meta.image : `./${meta.image}`;
        img.alt = `${meta.label} ì´ë¯¸ì§€`;
        img.className = 'heroimg';
        img.loading = 'lazy';
        img.decoding = 'async';
        img.referrerPolicy = 'no-referrer';
        imgWrap.appendChild(img);
      }

      let text = templates[t] || '';
      text = text.replaceAll('AAA', sanitize(a||'AAA'))
                 .replaceAll('BBB', sanitize(b))
                 .replaceAll('{ë°œì†¡í•œ ë‚ ì§œ}', sanitize(d));
      byId('message').textContent = text; // keep as textContent to avoid XSS
      byId('meta').textContent = `${d} Â· ìƒì„±ëœ ë§í¬ëŠ” ë©”ì‹œì§€ ë·°ì–´ ì „ìš©ì…ë‹ˆë‹¤.`;
    }

    function parseHash(){
      const h = location.hash || '';
      if(!h.startsWith('#')) return null;
      const params = new URLSearchParams(h.slice(1));
      if(params.get('v')!== '1') return null;
      const p = params.get('p');
      if(!p) return null;
      try{ return decodePayload(p); }catch{ return null; }
    }

    function init(){
      const data = parseHash();
      if(data){
        show('view');
        applyTemplate(data);
      } else {
        show('form');
      }
    }

    // Buttons in viewer
    byId('btn-copy').addEventListener('click', async ()=>{
      try{ await navigator.clipboard.writeText(location.href); alert('ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.'); }
      catch{ prompt('ë³µì‚¬í•  ë§í¬ì…ë‹ˆë‹¤. ìˆ˜ë™ ë³µì‚¬í•´ì£¼ì„¸ìš”:', location.href); }
    });

    byId('btn-share').addEventListener('click', async ()=>{
      if(navigator.share){
        try{ await navigator.share({ title: document.title, text: byId('view-title').textContent, url: location.href }); }
        catch{ /* user canceled */ }
      } else {
        alert('ì´ ë¸Œë¼ìš°ì €ëŠ” ê³µìœ  ê¸°ëŠ¥ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë§í¬ ë³µì‚¬ë¥¼ ì´ìš©í•´ì£¼ì„¸ìš”.');
      }
    });

    byId('btn-home').addEventListener('click', ()=>{
      history.pushState({}, '', location.pathname);
      show('form');
      // reset selection
      document.querySelectorAll('input[name="type"]').forEach(r=>r.checked=false);
      rowAAA.classList.add('hidden');
      inputAAA.value='';
      inputBBB.value='';
      window.scrollTo({top:0,behavior:'smooth'});
    });

    window.addEventListener('hashchange', init);
    init();
  </script>
</body>
</html>
