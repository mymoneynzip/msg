<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>경조사 메시지 생성기</title>
  <meta name="description" content="결혼, 장례, 돌잔치, 부모님잔치, 반려동물 장례 메시지 생성/공유" />
  <style>
    :root{
      --bg:#0b0c10; --card:#121319; --muted:#7d8590; --text:#e6edf3; --acc:#6dd3fb; --acc2:#b7f399;
      --danger:#ff6b6b; --ok:#34d399; --brand:#6366f1; --shadow:0 10px 30px rgba(0,0,0,.25);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:linear-gradient(180deg,#0b0c10, #0e1117 40%, #0b0c10);
         color:var(--text);font-family: ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans KR",Apple SD Gothic Neo,Helvetica,Arial,sans-serif;
         -webkit-font-smoothing:antialiased;}
    .wrap{max-width:680px;margin:0 auto;padding:24px;}
    .card{background:var(--card);border:1px solid #1f232b;border-radius:20px;padding:20px;box-shadow:var(--shadow)}
    h1{font-size:24px;margin:0 0 10px;letter-spacing:-.3px}
    p.lead{margin:0 0 16px;color:var(--muted);font-size:14px}
    .grid{display:grid;gap:14px}
    .row{display:flex;gap:8px;flex-wrap:wrap}
    label{display:block;font-weight:600;margin-bottom:8px}
    .radio-group{display:grid;gap:10px}
    .radio{display:flex;align-items:center;gap:10px;background:#0e1320;border:1px solid #202635;padding:12px;border-radius:14px}
    .radio input{transform:scale(1.2)}
    .note{font-size:12px;color:var(--muted)}
    input[type="text"], .ghost{
      width:100%;padding:12px 14px;border-radius:12px;border:1px solid #263042;background:#0b1222;color:var(--text);outline:none;
    }
    input[type="text"]:focus{border-color:var(--acc)}
    button{appearance:none;border:0;border-radius:14px;padding:14px 16px;font-weight:700;cursor:pointer}
    .btn{background:linear-gradient(135deg,var(--brand),#22d3ee);color:#fff;box-shadow:0 8px 20px rgba(99,102,241,.3)}
    .btn:active{transform:translateY(1px)}
    .btn-ghost{background:transparent;color:var(--text);border:1px solid #253046}
    .hidden{display:none}

    /* Viewer */
    .viewer h2{font-size:20px;margin:0 0 12px}
    .meta{display:flex;gap:8px;flex-wrap:wrap;color:var(--muted);font-size:12px;margin-bottom:10px}
    .paper{background:#0c111b;border:1px dashed #24314a;border-radius:16px;padding:18px}
    .heroimg{width:100%;max-height:320px;object-fit:cover;border-radius:12px;border:1px solid #24314a;display:block;margin:0 auto 10px;}
    .toolbar{display:flex;gap:8px;flex-wrap:wrap;margin-top:14px}
    .badge{display:inline-flex;align-items:center;gap:8px;padding:10px;border-radius:14px;border:1px solid #24314a;background:#0b1222}
    .ico{display:inline-grid;place-items:center;width:28px;height:28px;border-radius:9px;background:#111a2c}
    .ico svg{width:18px;height:18px}
    @media (prefers-color-scheme: light){
      :root{--bg:#f6f8fa;--card:#ffffff;--text:#0d1117;--muted:#57606a}
      body{background:linear-gradient(180deg,#f6f8fa,#fff)}
      .radio{background:#f8fafc;border-color:#e5e7eb}
      input[type="text"], .ghost{background:#fff;border-color:#e5e7eb}
      .paper{background:#fafcff;border-color:#e5e7eb}
      .btn-ghost{border-color:#e5e7eb}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <section id="screen-form" class="card">
      <div class="row" style="justify-content:space-between;align-items:center">
        <h1>경조사 메시지 생성기</h1>
        <div class="badge"><span class="ico" aria-hidden="true">💌</span>간편 생성 · 공유 링크</div>
      </div>
      <p class="lead">필요한 경조사 문구를 선택하고 정보를 입력하세요. 생성 후 링크로 공유할 수 있습니다.</p>
      <div class="grid">
        <div>
          <label>질문1. 경조사 종류를 선택하세요 <span class="note">(필수)</span></label>
          <div class="radio-group" role="radiogroup" aria-label="경조사 종류">
            <label class="radio"><input type="radio" name="type" value="wedding"> 결혼</label>
            <label class="radio"><input type="radio" name="type" value="funeral"> 가족장례식</label>
            <label class="radio"><input type="radio" name="type" value="firstbirthday"> 돌잔치</label>
            <label class="radio"><input type="radio" name="type" value="parents"> 부모님잔치</label>
            <label class="radio"><input type="radio" name="type" value="petfuneral"> 애견·애묘 장례식</label>
          </div>
        </div>
        <div id="row-aaa" class="hidden">
          <label>질문2. 돌잔치인 경우, 아이 이름 <span class="note">(선택)</span></label>
          <input type="text" id="input-aaa" maxlength="20" placeholder="아이 이름 (예: 지우)" />
          <p class="note">입력 시 메시지 내 AAA가 아이 이름으로 바뀝니다.</p>
        </div>
        <div>
          <label>질문3. 발송하는 분의 이름 <span class="note">(필수)</span></label>
          <input type="text" id="input-bbb" maxlength="20" placeholder="보내는 이 (예: 김OO)" required />
        </div>
        <div class="row" style="justify-content:flex-end;margin-top:4px">
          <button id="btn-generate" class="btn">생성된 경조사 문구 HTML 보기</button>
        </div>
      </div>
    </section>

    <section id="screen-view" class="card hidden viewer">
      <div class="row" style="justify-content:space-between;align-items:center">
        <h2 id="view-title">메시지 보기</h2>
        <div id="badge-type" class="badge"><span class="ico" id="type-emoji" aria-hidden="true">✨</span><span id="type-label">유형</span></div>
      </div>
      <div class="meta" id="meta"></div>
      <div class="paper">
        <div id="msg-image" style="text-align:center;margin-bottom:10px;font-size:28px"></div>
        <div id="message" class="msg"></div>
      </div>
      <div class="toolbar">
        <button id="btn-copy" class="btn">링크 복사</button>
        <button id="btn-share" class="btn-ghost">공유하기</button>
        <button id="btn-home" class="btn-ghost">처음으로</button>
      </div>
    </section>
  </div>

  <script>
    const $ = (s)=>document.querySelector(s);
    const byId = (id)=>document.getElementById(id);

    const typeMeta = {
      wedding: {label:'결혼', emoji:'💍', image:'./img01.png'},
      funeral: {label:'가족장례식', emoji:'🕊️', image:'./img02.png'},
      firstbirthday: {label:'돌잔치', emoji:'🎂', image:'./img03.png'},
      parents: {label:'부모님잔치', emoji:'🌷', image:'./img04.png'},
      petfuneral: {label:'애견·애묘 장례식', emoji:'🐾', image:'./img05.png'}
    };

    function todayString(){
      const now = new Date();
      return `${now.getFullYear()}년 ${String(now.getMonth()+1).padStart(2,'0')}월 ${String(now.getDate()).padStart(2,'0')}일`;
    }

    function randId(len=12){
      let s='';
      while(s.length<len){ s+=Math.random().toString(36).slice(2);}
      return s.slice(0,len);
    }

    function encodePayload(obj){
      const json = JSON.stringify(obj);
      const b64 = btoa(unescape(encodeURIComponent(json)));
      return b64.replaceAll('+','-').replaceAll('/','_').replace(/=+$/,'');
    }
    function decodePayload(str){
      const b64 = str.replaceAll('-','+').replaceAll('_','/');
      const pad = '='.repeat((4-(b64.length%4))%4);
      return JSON.parse(decodeURIComponent(escape(atob(b64+pad))));
    }

    function sanitize(text){return String(text||'').replace(/[&<>\"']/g,s=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[s]));}

    const templates = {
      wedding:`오래전부터 두 분의 소중한 인연을 지켜보며 오늘을 손꼽아 기다렸습니다. 진심으로 축하드립니다.
{발송한 날짜}
BBB 드림`,
      funeral:`가슴 아픈 소식에 슬픔을 금할 길이 없습니다.
{발송한 날짜}
BBB 드림`,
      firstbirthday:`사랑스러운 AAA의 첫 번째 생일을 진심으로 축하합니다.
{발송한 날짜}
BBB 드림`,
      parents:`사랑하는 부모님께서 맞으신 잔치를 진심으로 축하드립니다.
{발송한 날짜}
BBB 드림`,
      petfuneral:`사랑하는 가족을 떠나보낸 친구에게 깊은 위로의 마음을 전합니다.
{발송한 날짜}
BBB 드림`
    };

    const rowAAA = byId('row-aaa');
    const inputAAA = byId('input-aaa');
    const inputBBB = byId('input-bbb');

    document.querySelectorAll('input[name="type"]').forEach(r=>{
      r.addEventListener('change',()=>{rowAAA.classList.toggle('hidden',r.value!=='firstbirthday'||!r.checked);});
    });

    byId('btn-generate').addEventListener('click',(e)=>{
      e.preventDefault();
      const type=(document.querySelector('input[name="type"]:checked')||{}).value;
      if(!type){alert('경조사 종류를 선택하세요.'); return;}
      const bbbRaw = inputBBB.value.trim();
      if(!bbbRaw){alert('발송자 이름(BBB)을 입력하세요.'); return;}
      const aaaRaw = type==='firstbirthday'? inputAAA.value.trim(): '';
      const date = todayString();
      const payload = {t:type,a:aaaRaw,b:bbbRaw,d:date};
      const id = randId(12);
      const p = encodePayload(payload);
      const url = `${location.origin}${location.pathname}#v=1&r=${id}&p=${p}`;
      location.href = url;
    });

    function show(name){
      byId('screen-form').classList.toggle('hidden',name!=='form');
      byId('screen-view').classList.toggle('hidden',name!=='view');
    }

    function applyTemplate({t,a,b,d}){
      const meta = typeMeta[t] || {label:'메시지',emoji:'✨',image:'✨'};
      byId('view-title').textContent = `${meta.label} 메시지`;
      byId('type-label').textContent = meta.label;
      byId('type-emoji').textContent = meta.emoji;
      const imgWrap = byId('msg-image'); imgWrap.innerHTML='';
      if(meta.image){
        const img = document.createElement('img');
        img.src = /^(https?:)?\//.test(meta.image)? meta.image : `./${meta.image}`;
        img.alt = `${meta.label} 이미지`; img.className='heroimg'; img.loading='lazy';
        img.decoding='async'; img.referrerPolicy='no-referrer'; imgWrap.appendChild(img);
      }
      let text = templates[t]||'';
      text = text.replaceAll('AAA',sanitize(a||'AAA')).replaceAll('BBB',sanitize(b)).replaceAll('{발송한 날짜}',sanitize(d));
      byId('message').textContent = text;
      byId('meta').textContent = `${d} · 생성된 링크는 메시지 뷰어 전용입니다.`;
    }

    function parseHash(){
      const h=location.hash||''; if(!h.startsWith('#')) return null;
      const params=new URLSearchParams(h.slice(1)); if(params.get('v')!=='1') return null;
      const p=params.get('p'); if(!p) return null;
      try{return decodePayload(p);}catch{return null;}
    }

    function init(){
      const data=parseHash();
      if(data){show('view'); applyTemplate(data);} else {show('form');}
    }

    byId('btn-copy').addEventListener('click', async()=>{
      try{ await navigator.clipboard.writeText(location.href); alert('링크가 복사되었습니다.'); }
      catch{ prompt('복사할 링크입니다. 수동 복사해주세요:',location.href);}
    });

    byId('btn-share').addEventListener('click', async()=>{
      if(navigator.share){try{await navigator.share({title:document.title,text:byId('view-title').textContent,url:location.href});}catch{}}
      else{alert('이 브라우저는 공유 기능을 지원하지 않습니다. 링크 복사를 이용해주세요.');}
    });

    byId('btn-home').addEventListener('click',()=>{
      history.pushState({},'',location.pathname); show('form');
      document.querySelectorAll('input[name="type"]').forEach(r=>r.checked=false);
      rowAAA.classList.add('hidden'); inputAAA.value=''; inputBBB.value=''; window.scrollTo({top:0,behavior:'smooth'});
    });

    window.addEventListener('hashchange',init);
    init();
  </script>
</body>
</html>
